# ğŸ—ï¸ RentMyVroom Architecture

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT LAYER                          â”‚
â”‚  (Frontend App / Mobile App / Third-party Integrations)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/REST
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY                             â”‚
â”‚                    (NestJS Main)                             â”‚
â”‚  - CORS                                                      â”‚
â”‚  - Rate Limiting                                             â”‚
â”‚  - Global Validation                                         â”‚
â”‚  - Swagger Documentation                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth   â”‚  â”‚  Users   â”‚  â”‚ Vehicles â”‚
â”‚  Module  â”‚  â”‚  Module  â”‚  â”‚  Module  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bookings â”‚  â”‚ Messages â”‚  â”‚ Reviews  â”‚
â”‚  Module  â”‚  â”‚  Module  â”‚  â”‚  Module  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Uploads  â”‚  â”‚Notificationsâ”‚ Prisma   â”‚
â”‚  Module  â”‚  â”‚   Module  â”‚  â”‚ Module   â”‚
â”‚  (R2)    â”‚  â”‚  (Email)  â”‚  â”‚  (DB)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Cloudflareâ”‚  â”‚   SMTP   â”‚  â”‚PostgreSQLâ”‚
â”‚    R2    â”‚  â”‚  Server  â”‚  â”‚ Database â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Module Dependencies

```
AppModule
â”œâ”€â”€ ConfigModule (Global)
â”œâ”€â”€ ThrottlerModule (Rate Limiting)
â”œâ”€â”€ PrismaModule (Global)
â”‚   â””â”€â”€ PrismaService
â”‚
â”œâ”€â”€ AuthModule
â”‚   â”œâ”€â”€ JwtModule
â”‚   â”œâ”€â”€ PassportModule
â”‚   â”œâ”€â”€ AuthService
â”‚   â”œâ”€â”€ JwtStrategy
â”‚   â””â”€â”€ AuthController
â”‚
â”œâ”€â”€ UsersModule
â”‚   â”œâ”€â”€ NotificationsModule
â”‚   â”œâ”€â”€ UsersService
â”‚   â””â”€â”€ UsersController
â”‚
â”œâ”€â”€ VehiclesModule
â”‚   â”œâ”€â”€ VehiclesService
â”‚   â””â”€â”€ VehiclesController
â”‚
â”œâ”€â”€ BookingsModule
â”‚   â”œâ”€â”€ NotificationsModule
â”‚   â”œâ”€â”€ BookingsService
â”‚   â””â”€â”€ BookingsController
â”‚
â”œâ”€â”€ MessagesModule
â”‚   â”œâ”€â”€ MessagesService
â”‚   â””â”€â”€ MessagesController
â”‚
â”œâ”€â”€ ReviewsModule
â”‚   â”œâ”€â”€ ReviewsService
â”‚   â””â”€â”€ ReviewsController
â”‚
â”œâ”€â”€ UploadsModule
â”‚   â”œâ”€â”€ UploadsService (Cloudflare R2)
â”‚   â””â”€â”€ UploadsController
â”‚
â””â”€â”€ NotificationsModule
    â””â”€â”€ NotificationsService (Nodemailer)
```

## Data Flow Examples

### 1. User Registration Flow
```
Client
  â”‚
  â”œâ”€â–º POST /auth/register
  â”‚     â”‚
  â”‚     â”œâ”€â–º AuthController.register()
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º AuthService.register()
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â–º Check existing user (Prisma)
  â”‚     â”‚     â”‚     â”œâ”€â–º Hash password (bcrypt)
  â”‚     â”‚     â”‚     â”œâ”€â–º Create user (Prisma)
  â”‚     â”‚     â”‚     â””â”€â–º Generate JWT tokens
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º Return { user, accessToken, refreshToken }
  â”‚     â”‚
  â”‚     â””â”€â–º Response: 201 Created
  â”‚
  â””â”€â–º Store tokens in client
```

### 2. Create Booking Flow
```
Renter Client
  â”‚
  â”œâ”€â–º POST /bookings (with JWT)
  â”‚     â”‚
  â”‚     â”œâ”€â–º JwtAuthGuard validates token
  â”‚     â”œâ”€â–º RolesGuard checks RENTER role
  â”‚     â”‚
  â”‚     â”œâ”€â–º BookingsController.create()
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º BookingsService.create()
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â–º Verify license approved (Prisma)
  â”‚     â”‚     â”‚     â”œâ”€â–º Get vehicle details (Prisma)
  â”‚     â”‚     â”‚     â”œâ”€â–º Calculate total price
  â”‚     â”‚     â”‚     â”œâ”€â–º Create booking (Prisma)
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â””â”€â–º NotificationsService.sendNewBookingEmail()
  â”‚     â”‚     â”‚           â”‚
  â”‚     â”‚     â”‚           â””â”€â–º Send email to merchant (SMTP)
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º Return booking details
  â”‚     â”‚
  â”‚     â””â”€â–º Response: 201 Created
  â”‚
  â””â”€â–º Display booking confirmation
```

### 3. File Upload Flow
```
Client
  â”‚
  â”œâ”€â–º POST /uploads/presign (with JWT)
  â”‚     â”‚
  â”‚     â”œâ”€â–º JwtAuthGuard validates token
  â”‚     â”‚
  â”‚     â”œâ”€â–º UploadsController.getPresignedUrl()
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º UploadsService.getPresignedUrl()
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â–º Generate unique filename
  â”‚     â”‚     â”‚     â”œâ”€â–º Create S3 PutObjectCommand
  â”‚     â”‚     â”‚     â”œâ”€â–º Generate presigned URL (R2)
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â””â”€â–º Return { uploadUrl, publicUrl }
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º Response: 200 OK
  â”‚     â”‚
  â”‚     â””â”€â–º Receive presigned URL
  â”‚
  â”œâ”€â–º PUT to presigned URL (direct to R2)
  â”‚     â”‚
  â”‚     â””â”€â–º Upload file to Cloudflare R2
  â”‚
  â””â”€â–º Use publicUrl in subsequent requests
```

## Database Schema Relationships

```
User (MERCHANT)
  â”‚
  â”œâ”€â”€< has many >â”€â”€â”
  â”‚                â”‚
  â–¼                â–¼
Vehicle        Booking (as merchant)
  â”‚                â”‚
  â”œâ”€â”€< has many >â”€â”€â”¤
  â”‚                â”‚
  â–¼                â–¼
Booking        Message (received)
  â”‚
  â”œâ”€â”€< has one >â”€â”€ Review
  â”‚
  â””â”€â”€< has many >â”€ Message


User (RENTER)
  â”‚
  â”œâ”€â”€< has many >â”€â”€ Booking (as renter)
  â”‚                    â”‚
  â”‚                    â”œâ”€â”€< has many >â”€â”€ Message (sent)
  â”‚                    â”‚
  â”‚                    â””â”€â”€< has one >â”€â”€â”€ Review
  â”‚
  â””â”€â”€< has many >â”€â”€ Review (as reviewer)


User (any)
  â”‚
  â””â”€â”€< has many >â”€â”€ RefreshToken
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. POST /auth/login
       â”‚    { email, password }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthController     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Validate credentials
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuthService       â”‚
â”‚  - Find user        â”‚
â”‚  - Compare password â”‚
â”‚  - Generate tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Store refresh token
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database          â”‚
â”‚  RefreshToken table â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Return tokens
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚ Store tokensâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Subsequent Requests:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚ + Bearer    â”‚
â”‚   Token     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Authorization: Bearer <token>
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JwtAuthGuard       â”‚
â”‚  - Verify signature â”‚
â”‚  - Check expiration â”‚
â”‚  - Extract payload  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User object
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RolesGuard         â”‚
â”‚  - Check user role  â”‚
â”‚  - Match required   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Authorized
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller        â”‚
â”‚   Execute logic     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Layers

```
Request
  â”‚
  â”œâ”€â–º 1. CORS Check
  â”‚     â””â”€â–º Allowed origins only
  â”‚
  â”œâ”€â–º 2. Rate Limiting
  â”‚     â””â”€â–º Max 10 req/min
  â”‚
  â”œâ”€â–º 3. Input Validation
  â”‚     â””â”€â–º class-validator DTOs
  â”‚
  â”œâ”€â–º 4. JWT Authentication
  â”‚     â””â”€â–º JwtAuthGuard
  â”‚
  â”œâ”€â–º 5. Role Authorization
  â”‚     â””â”€â–º RolesGuard
  â”‚
  â”œâ”€â–º 6. Business Logic
  â”‚     â””â”€â–º Service layer
  â”‚
  â””â”€â–º Response
```

## Deployment Architecture (Recommended)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Load Balancer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NestJS  â”‚      â”‚ NestJS  â”‚
â”‚Instance â”‚      â”‚Instance â”‚
â”‚   #1    â”‚      â”‚   #2    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚      â”‚Cloudflareâ”‚
â”‚ Primary  â”‚      â”‚    R2    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚
â”‚ Replica  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Technology Stack Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer           â”‚
â”‚  - NestJS 10                        â”‚
â”‚  - TypeScript 5                     â”‚
â”‚  - Node.js 18+                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Business Logic              â”‚
â”‚  - Services (Business rules)        â”‚
â”‚  - Controllers (HTTP handlers)      â”‚
â”‚  - Guards (Auth & Authorization)    â”‚
â”‚  - Pipes (Validation)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Data Access Layer           â”‚
â”‚  - Prisma ORM                       â”‚
â”‚  - PostgreSQL                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      External Services              â”‚
â”‚  - Cloudflare R2 (Storage)          â”‚
â”‚  - SMTP (Email)                     â”‚
â”‚  - JWT (Authentication)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture ensures:
- âœ… Scalability
- âœ… Maintainability
- âœ… Security
- âœ… Performance
- âœ… Testability
